<% @flats.each do |flat|%>
<div class="flat-conteneur">
  <div class="pictures-conteneur">
    <div class="picture-principale" style="background-image: url(<%= image_path flat.pictures.split(" ")[0] %>); background-size: cover;">
    </div>
    <div class="picture-grille">
      <div class="picture-left-top">
        <p>Picture here...</p>
      </div>
      <div class="picture-right-top">
        <p>Picture here...</p>
      </div>
      <div class="picture-left-down">
        <p>Picture here...</p>
      </div>
      <div class="picture-right-down">
        <p>Picture here...</p>
      </div>
    </div>
  </div>
  <div class="bottom-conteneur">
    <div class="description-card">
      <div class="section-description">
        <h2><%= flat.name %></h2>
      </div>
      <div class="section-description">
        <i class="fa-solid fa-star fa-lg" style="color: #e6c700;"></i>
        <p><strong>4.8 en moyenne</strong></p>
      </div>
      <div class="section-description">
        <i class="fa-solid fa-location-pin fa-lg" style="color: #25316d;"></i>
        <p><%= flat.location %></p>
      </div>
      <div class="section-description">
        <p><%= flat.description %></p>
      </div>
      <div class="section-description">
        <i class="fa-solid fa-battery fa-lg" style="color: green;"></i>
        <p><strong>Autonomie : <%= flat.autonomy_level %>/5</strong></p>
      </div>
      <div class="section-description">
        <p><i class="fa-solid fa-user fa-lg" style="color: brown;"></i> À propos de <i><%= flat.user.first_name %></i> : <%= flat.user.biography %></p>
      </div>
      <div class="section-description">
        <i class="fa-solid fa-map fa-lg" style="color: blue;"></i>
        <div class="map-conteneur">
          <div class="map-display" data-controller="map" data-map-markers-value="<%= @markers.to_json %>" data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"></div>
        </div>
      </div>
        <div class="section-description">
          <% flat.bookings.each do |booking| %>
            <% booking.reviews.each do |review| %>
              <%= review.content %> <br>
              Rating : <%= review.rating %> / 5
            <% end %>
          <% end %>
        </div>
      </div>
    <div class="book-container d-flex flex-column w-25 align-items-center" style="height: 300px; position: sticky; top: 80px;">
      <div class="book-card w-75 h-75">
        <div class="section-book">
          <h4><strong><%= flat.price_per_month %>€ / mois</strong></h4>
        </div>
      </div>
      <button class="btn btn-outline-danger mt-2 w-75" style="position: sticky;"><%= link_to 'Delete flat', flat_path(flat), data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' }, style: 'text-decoration: none; color: black'%></button>
    </div>
  </div>
  <% if @flats.empty? %>
    <%= link_to 'New Flat', new_flat_path, class: 'btn btn-primary' %>
  <% end %>
</div>
  <% if flat.user == current_user %>
  <div class="section-description">
    <i class="fa-solid fa-trash fa-lg" style="color: red;"></i>
    <%= link_to 'Delete', flat_path(flat), data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' } %>
  </div>
  <% end %>
  <% if flat.bookings.any? %>
    <ul>
    <% flat.bookings.each do |booking| %>
      <li>Réservé du <%= booking.start_date %> au <%= booking.end_date %></li>
    <% end %>
    </ul>
  <% end %>
<% end  %>
